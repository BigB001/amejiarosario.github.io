<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="author" content="Adrian Mejia">
    <link rel="author" href="humans.txt" />
    <meta name="description" content="Adrian Mejia blog about programming and software engineering. Featuring MEAN stack (AngularJS, NodeJS, MongoDB and Express), BackboneJS, RESTful APIs, Algorithms and data structures.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Adrian Mejia's Blog" href="/feed.xml"/>

    
    <title>Creating RESTful APIs with NodeJS and MongoDB Tutorial | Adrian Mejia Blog</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="canonical" href="http://adrianmejia.com/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/index.html" />
    <!-- Open Graph -->
    <meta property="og:url" content="http://adrianmejia.com/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/index.html" />
    <meta property="og:site_name" content="Adrian Mejia Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Welcome to this RESTful API using Node.js (Express.js) and MongoDB (mongoose) tutorial. You can follow alone to make a stand alone API endpoint, or you could also check out our AngularJS or BackboneJS tutorials to build a javascript-client that connects with the endpoint we are going to built." />
    <meta property="og:image" content="http://adrianmejia.com/images/RESTfulAPIs_NodeJS__mongodb_728x360.png" />
    <meta property="og:title" content="Creating RESTful APIs with NodeJS and MongoDB Tutorial" />
    <meta property="fb:app_id" content="761831487293468" />
    <meta property="fb:admins" content="895685163"/>
    <!-- /Open Graph -->

    <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-24183929-4', 'auto');
ga('require', 'linkid');
ga('set', 'transport', 'beacon');
ga('set', 'appName', 'adrianmejia.com');
ga('send', 'pageview');
ga('send', 'screenview', {screenName: document.title });
</script><script async src='https://www.google-analytics.com/analytics.js'></script>


    <!-- Styles -->
    <link rel="stylesheet" href="/stylesheets/main.css">    <link rel="stylesheet" href="/stylesheets/font-awesome.min.css">  </head>
  <body>
    <header class="titlebar mdl-shadow--2dp">
      <div class="container align-center flexbox--space-between">
        <!-- <div class="row"> -->
          <!-- <div class="col-md-12"> -->
            <span class="hidden-mobile-up">
              <i class="fa fa-bars" aria-hidden="true"></i>
            </span>

            <a href="/" class="align-center">
              <img src="/images/logo-adrianmejia.png" alt="" class="animation--bounce-in"/>
              <h1 class="hidden-mobile-down m-x-1 logo">
                <span class="animation--bounce-in">Adrian</span>
                <span class="animation--bounce-in">Mejia</span>
              </h1>
            </a>

            <nav class="hidden-mobile-down navbar">
              
                <a href="/#home" class="animation--radial-out" id="Home">Home</a>
              
                <a href="/#trending-posts" class="animation--radial-out" id="Trending">Trending</a>
              
                <a href="/#about" class="animation--radial-out" id="About">About</a>
              
                <a href="/blog" class="animation--radial-out" id="Blog">Blog</a>
              
              <i class="fa fa-search" aria-hidden="true"></i>
            </nav>

            <div class="hidden-mobile-up">
              <i class="fa fa-search" aria-hidden="true"></i>
            </div>
          <!-- </div> -->
        <!-- </div> -->
      </div>
    </header>
    <nav class="hidden-mobile-up mdl-shadow--2dp">
      <div class="container flexbox--space-between navbar">
        
          <a href="/#home" class="animation--underline-from-center">Home</a>
        
          <a href="/#trending-posts" class="animation--underline-from-center">Trending</a>
        
          <a href="/#about" class="animation--underline-from-center">About</a>
        
          <a href="/blog" class="animation--underline-from-center">Blog</a>
        
      </div>
    </nav>

    <main>
      <!--https://developers.google.com/search/docs/data-types/articles-->
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": ""
  },
  "headline": "Creating RESTful APIs with NodeJS and MongoDB Tutorial",
  
  "image": {
    "@type": "ImageObject",
    "url": "http://adrianmejia.com/images/RESTfulAPIs_NodeJS__mongodb_728x360.png",
    "height": 360,
    "width": 728
  },
  
  "datePublished": "2014-10-01T17:26:42-04:00",
  "dateModified": "2016-07-28T16:12:38-04:00",
  "author": {
    "@type": "Person",
    "name": "Adrian Mejia"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Adrian Mejia",
    "logo": {
      "@type": "ImageObject",
      "url": "http://adrianmejia.com/images/logo.png",
      "width": 600,
      "height": 60
    }
  },
  "description": "Welcome to this RESTful API using Node.js (Express.js) and MongoDB (mongoose) tutorial. You can follow alone to make a stand alone API endpoint, or you could also check out our AngularJS or BackboneJS tutorials to build a javascript-client that connects with the endpoint we are going to built."
}
</script>


<article class="container post">

  <section class="hero">
    <div class="muted">
      <a class="category-link" href="/categories/Technologies/">Technologies</a> > <a class="category-link" href="/categories/Technologies/Web-Development/">Web Development</a>
    </div>
    <h1>Creating RESTful APIs with NodeJS and MongoDB Tutorial</h1>
    <div class="muted">
      <span title="Last time this post was updated">
        <i class="fa fa-calendar" aria-hidden="true"></i>
        Last update
        <time datetime="2016-07-28T20:12:38.000Z" itemprop="dateUpdated">July 28th 2016</time>
      </span>

      
        <span class="m-x-2" title="Pageviews">
          <i class="fa fa-eye" aria-hidden="true"></i>
          315.4k
        </span>
      

      <span class="m-x-2" title="Click to go to the comments section">
        <a href="#disqus_thread">
          <i class="fa fa-comment-o" aria-hidden="true"></i>
          <span class="disqus-comment-count" data-disqus-url="http://adrianmejia.com/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/">0</span>
        </a>
      </span>

      
        <span>
          <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ExpressJS/">ExpressJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJS/">NodeJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tutorial-MEAN-Stack/">Tutorial_MEAN-Stack</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">10</span></li></ul>
        </span>
      
    </div>
  </section>

  <div class="art-container" style="background-color: #4C4D4E">
    
      <picture>
        <source media="(min-width: 728px)" srcset="/images/RESTfulAPIs_NodeJS__mongodb_728x360.png">
        <source srcset="/images/RESTfulAPIs_NodeJS__mongodb_320x250.png">
        <img src="/images/RESTfulAPIs_NodeJS__mongodb_728x360.png" alt="Creating RESTful APIs with NodeJS and MongoDB Tutorial">
      </picture>
    
  </div>

  <div class="row">
    <section class="col-sm-8 p-x-2">

      <div class="post-content  toc-content ">
        <p>Welcome to this RESTful API using Node.js (Express.js) and MongoDB (mongoose) tutorial. You can follow alone to make a stand alone API endpoint, or you could also check out our <a href="/blog/2014/09/28/angularjs-tutorial-for-beginners-with-nodejs-expressjs-and-mongodb" target="_blank">AngularJS</a> or <a href="/blog/2012/09/11/backbone-dot-js-for-absolute-beginners-getting-started" target="_blank">BackboneJS</a> tutorials to build a javascript-client that connects with the endpoint we are going to built.</p>
<a id="more"></a>
<h1 id="What-is-a-RESTful-API">What is a RESTful API?<a href="#What-is-a-RESTful-API" class="headerlink" title="What is a RESTful API?"></a></h1><p>REST stands for Representational State Transfer. It is an architecture that allows <code>client-server</code> communication through a uniform interface. They are also <code>stateless</code>, <code>cachable</code> and has property called <code>idempotence</code>, which means that the side effect of multiple identical requests have the same effect as the same single request.</p>
<p>HTTP RESTful API’s are compose of:</p>
<ul>
<li>HTTP methods, e.g. GET, PUT, DELETE, PATCH, POST, …</li>
<li>Base URI, e.g. <code>http://adrianmejia.com</code></li>
<li>URL path, e.g. <code>/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/</code></li>
<li>Media type, e.g. <code>html</code>, <code>JSON</code>, <code>XML</code>, <code>Microformats</code>, <code>Atom</code>, <code>Images</code>…</li>
</ul>
<p>Here’s is a summary what we want to implement:</p>
<table>
<thead>
<tr>
<th>Resource (URI)</th>
<th>POST (create)</th>
<th>GET (read)</th>
<th>PUT (update)</th>
<th>DELETE (destroy)</th>
</tr>
</thead>
<tbody>
<tr>
<td>/todos</td>
<td>create new task</td>
<td>list tasks</td>
<td>N/A (update all)</td>
<td>N/A (destroy all)</td>
</tr>
<tr>
<td>/todos/1</td>
<td>error</td>
<td>show task ID 1</td>
<td>update task ID 1</td>
<td>destroy task ID 1</td>
</tr>
</tbody>
</table>
<p><strong>NOTES</strong>:</p>
<ul>
<li>Format will be JSON.</li>
<li>Bulk updates and bulk destroys are not safe, so we will not be implementing those.</li>
<li>POST, GET, PUT, DELETE == <strong>C</strong>REATE, <strong>R</strong>EAD, <strong>U</strong>PDATE, <strong>D</strong>ELETE == <strong>CRUD</strong>.</li>
</ul>
<h1 id="Installing-the-MEAN-Stack-Backend">Installing the MEAN Stack Backend<a href="#Installing-the-MEAN-Stack-Backend" class="headerlink" title="Installing the MEAN Stack Backend"></a></h1><p>In this section we are going to install the backend components of the MEAN stack: MongoDB, NodeJS and ExpressJS.</p>
<p>Note: If already have installed NodeJS, MongoDB (Mongoose), ExpressJS and knows about them separately then you can jump to <a href="#wiring-up-the-mean-stack">wiring the stack</a>, which is where the hands on start. Otherwise, if you want to review/learn about each member of the stack then follow alone and enjoy the ride!</p>
<h2 id="Installing-MongoDB">Installing MongoDB<a href="#Installing-MongoDB" class="headerlink" title="Installing MongoDB"></a></h2><p>MongoDB is a document-oriented NoSQL database (Big Data ready). It stores data in JSON-like format and allows to perform SQL-like queries against it.</p>
<p>You can installed following the <a href="http://docs.mongodb.org/manual/installation/" target="_blank">instructions here</a>. If you have a Mac and <a href="http://brew.sh/" target="_blank">brew</a> it’s just: <code>brew install mongodb &amp;&amp; mongod</code>. In ubuntu <code>sudo apt-get -y install mongodb</code>.</p>
<p>Check version:
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Mac</span></div><div class="line">mongod --version</div><div class="line"><span class="comment"># =&gt; db version v2.6.4</span></div><div class="line"><span class="comment"># =&gt; 2014-10-01T19:07:26.649-0400 git version: nogitversion</span></div><div class="line"></div><div class="line"><span class="comment"># Ubuntu</span></div><div class="line">mongod --version</div><div class="line"><span class="comment"># =&gt; db version v2.0.4, pdfile version 4.5</span></div><div class="line"><span class="comment"># =&gt; Wed Oct  1 23:06:54 git version: nogitversion</span></div></pre></td></tr></table></figure></p>
<h2 id="Installing-NodeJS">Installing NodeJS<a href="#Installing-NodeJS" class="headerlink" title="Installing NodeJS"></a></h2><p>For short NodeJS is Javascript running outside the browser, in this case in the server.</p>
<p>To install it, you can go to <a href="http://nodejs.org/" target="_blank">NodeJS Website</a>. But if you are using Mac and <a href="http://brew.sh" target="_blank">brew</a> you can do <code>brew install nodejs</code> and in ubuntu use <a href="https://github.com/creationix/nvm" target="_blank" rel="external">nvm</a> to install it. Once you have continue.</p>
<p>Check node version and npm (node package manager) version:
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">node -v</div><div class="line"><span class="comment"># =&gt; v0.10.30</span></div><div class="line"></div><div class="line">npm -v</div><div class="line"><span class="comment"># =&gt; 2.0.0-alpha-5</span></div></pre></td></tr></table></figure></p>
<h2 id="Installing-ExpressJS">Installing ExpressJS<a href="#Installing-ExpressJS" class="headerlink" title="Installing ExpressJS"></a></h2><p>ExpressJS is web application framework that runs on NodeJS. Allows you to build web applications and APIs endpoints. (mode details later).</p>
<p>Install it using npm:
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g express</div></pre></td></tr></table></figure></p>
<p>Notice <code>-g</code>. It will install <code>express</code> globally and add it the <code>PATH</code>, so you can run it from anywhere.</p>
<p>Check version:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">express -V</div><div class="line"># =&gt; 4.9.0</div></pre></td></tr></table></figure></p>
<h1 id="Using-MongoDB-with-Mongoose">Using MongoDB with Mongoose<a href="#Using-MongoDB-with-Mongoose" class="headerlink" title="Using MongoDB with Mongoose"></a></h1><p>Mongoose is an NPM package that allows to interact with MongoDB. You can install it as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install mongoose</div></pre></td></tr></table></figure>
<p>If follow the previous steps you should have all you need to complete this tutorial. Basically, we are going to build an API that allow users to CRUD (Create-Read-Update-Delete) Todo tasks from database.</p>
<h2 id="Mongoose-CRUD">Mongoose CRUD<a href="#Mongoose-CRUD" class="headerlink" title="Mongoose CRUD"></a></h2><p>CRUD = <strong>C</strong>reate-<strong>R</strong>ead-<strong>U</strong>pdate-<strong>D</strong>elete</p>
<p>We can play with Mongoose in the console. In the <code>todoApp</code> type <code>node</code> to enter in the node CLI. Then:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"></div><div class="line"><span class="comment">/* prompt&gt; */</span> mongoose.connect(<span class="string">'mongodb://localhost/test3'</span>);</div><div class="line"></div><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> TodoSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">  name: <span class="built_in">String</span>,</div><div class="line">  completed: <span class="built_in">Boolean</span>,</div><div class="line">  note: <span class="built_in">String</span>,</div><div class="line">  updated_at: &#123; type: <span class="built_in">Date</span>, <span class="keyword">default</span>: <span class="built_in">Date</span>.now &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> Todo = mongoose.model(<span class="string">'Todo'</span>, TodoSchema);</div></pre></td></tr></table></figure>
<h2 id="Mongoose-Create">Mongoose Create<a href="#Mongoose-Create" class="headerlink" title="Mongoose Create"></a></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> todo = <span class="keyword">new</span> Todo(&#123;name: <span class="string">'Master NodeJS'</span>, completed: <span class="literal">false</span>, note: <span class="string">'Getting there...'</span>&#125;);</div><div class="line"></div><div class="line"><span class="comment">/* prompt&gt; */</span> todo.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(err)</div><div class="line">        <span class="built_in">console</span>.log(err);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">console</span>.log(todo);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>You can also build the object and save in one step using <code>create</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.create(&#123;name: <span class="string">'Master Javscript'</span>, completed: <span class="literal">true</span>, note: <span class="string">'Getting better everyday'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, todo</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(err) <span class="built_in">console</span>.log(err);</div><div class="line">    <span class="keyword">else</span> <span class="built_in">console</span>.log(todo);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="Mongoose-Read-and-Query">Mongoose Read and Query<a href="#Mongoose-Read-and-Query" class="headerlink" title="Mongoose Read and Query"></a></h2><p>There are multiple options for reading/querying data:</p>
<ul>
<li>Model.find(conditions, [fields], [options], [callback])</li>
<li>Model.findById(id, [fields], [options], [callback])</li>
<li>Model.findOne(conditions, [fields], [options], [callback])</li>
</ul>
<p>Some examples:</p>
<figure class="highlight javascript"><figcaption><span>Find all</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.find(<span class="function"><span class="keyword">function</span> (<span class="params">err, todos</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">  <span class="built_in">console</span>.log(todos)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>You can also add queries</p>
<figure class="highlight javascript"><figcaption><span>Find with queries</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</div><div class="line">  <span class="keyword">else</span> <span class="built_in">console</span>.log(data);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Get all completed tasks</span></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.find(&#123;completed: <span class="literal">true</span> &#125;, callback);</div><div class="line"></div><div class="line"><span class="comment">// Get all tasks ending with `JS`</span></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.find(&#123;name: <span class="regexp">/JS$/</span> &#125;, callback);</div></pre></td></tr></table></figure>
<p>You can chain multiple queries, e.g.:</p>
<figure class="highlight javascript"><figcaption><span>Chaining queries</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* prompt&gt; */</span> <span class="keyword">var</span> oneYearAgo = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">oneYearAgo.setYear(oneYearAgo.getFullYear() - <span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="comment">// Get all tasks staring with `Master`, completed</span></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.find(&#123;name: <span class="regexp">/^Master/</span>, completed: <span class="literal">true</span> &#125;, callback);</div><div class="line"></div><div class="line"><span class="comment">// Get all tasks staring with `Master`, not completed and created from year ago to now...</span></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.find(&#123;name: <span class="regexp">/^Master/</span>, completed: <span class="literal">false</span> &#125;).where(<span class="string">'updated_at'</span>).gt(oneYearAgo).exec(callback);</div></pre></td></tr></table></figure>
<h2 id="Mongoose-Update">Mongoose Update<a href="#Mongoose-Update" class="headerlink" title="Mongoose Update"></a></h2><p>Each model has an <code>update</code> method which accepts multiple updates (for batch updates because doesn’t return an array with data). Alternatively, the method <code>findOneAndUpdate</code> could be used to update just one and return an object.</p>
<ul>
<li>Model.update(conditions, update, [options], [callback])</li>
<li>Model.findByIdAndUpdate(id, [update], [options], [callback])</li>
<li>Model.findOneAndUpdate([conditions], [update], [options], [callback])</li>
</ul>
<figure class="highlight javascript"><figcaption><span>Todo.update and Todo.findOneAndUpdate</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// Model.update(conditions, update, [options], [callback])</span></div><div class="line"><span class="comment">// update `multi`ple tasks from complete false to true</span></div><div class="line"></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.update(&#123; completed: <span class="literal">false</span> &#125;, &#123; completed: <span class="literal">true</span> &#125;, &#123; multi: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, numberAffected, raw</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'The number of updated documents was %d'</span>, numberAffected);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'The raw response from Mongo was '</span>, raw);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//Model.findOneAndUpdate([conditions], [update], [options], [callback])</span></div><div class="line"><span class="comment">/* prompt&gt; */</span> Todo.findOneAndUpdate(&#123;name: <span class="regexp">/JS$/</span> &#125;, &#123;completed: <span class="literal">false</span>&#125;, callback);</div></pre></td></tr></table></figure>
<h2 id="Mongoose-Delete">Mongoose Delete<a href="#Mongoose-Delete" class="headerlink" title="Mongoose Delete"></a></h2><p><code>update</code> and <code>remove</code> mongoose API are identical, the only difference it is that no elements are returned.</p>
<ul>
<li>Model.remove(conditions, [callback])</li>
<li>Model.findByIdAndRemove(id, [options], [callback])</li>
<li>Model.findOneAndRemove(conditions, [options], [callback])</li>
</ul>
<h1 id="ExpressJS-and-Middlewares">ExpressJS and Middlewares<a href="#ExpressJS-and-Middlewares" class="headerlink" title="ExpressJS and Middlewares"></a></h1><p>ExpressJS is a complete web framework solution. It has HTML template solutions (jade, ejs, handlebars, hogan.js) and CSS precompilers (less, stylus, compass). Through middlewares layers, it handles: cookies, sessions, caching, CSRF, compression and many more.</p>
<p><strong>Middlewares</strong> are a stack of processors that runs on each request made to the server. You can have any number of middlewares that will process the request one by one in a serial fashion. Some might alter the request input, log outputs, add data and pass it to the <code>next()</code> middleware in the chain.</p>
<p>Middlewares are added to ExpressJS stack using <code>app.use</code> for any method or the app.VERB (e.g., <code>app.get</code>, <code>app.delete</code>, <code>app.post</code>, <code>app.update</code>, …)</p>
<p><img src="/images/express-middlewares.png" alt="ExpressJS Middlewares"></p>
<p>Let’s say you want to log the IP of the client on each request:</p>
<figure class="highlight javascript"><figcaption><span>Log the client IP on every request</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ip = req.headers[<span class="string">'x-forwarded-for'</span>] || req.connection.remoteAddress;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Client IP:'</span>, ip);</div><div class="line">  next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>You can also specify a path that you want the middleware to activate on.</p>
<figure class="highlight javascript"><figcaption><span>Middleware mounted on "/todos/:id" and log the request method</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="string">'/todos/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Request Type:'</span>, req.method);</div><div class="line">  next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>And finally you can use <code>app.get</code> to catch GET request with maching route, reply the request with a <code>response.send</code> and end the middleware chain. Let’s use what we learned on <a href="#mongoose-read-and-query">mongoose read</a> to reply with a user data matching the <code>id</code>.</p>
<figure class="highlight javascript"><figcaption><span>Middleware mounted on "/todos/:id" and returns</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/todos/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.findById(req.params.id, <span class="function"><span class="keyword">function</span>(<span class="params">err, todo</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(err) res.send(err);</div><div class="line">    res.json(todo);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Notice that all previous middlewares called <code>next()</code> except this last one, because it sends a respond (in JSON) to the client with the requeste <code>todo</code> data.</p>
<p>Hopefully, you don’t have to develop a bunch of middlewares besides routes, since ExpressJS has a bunch of middlewares available.</p>
<h2 id="Default-Express-4-0-middlewares">Default Express 4.0 middlewares<a href="#Default-Express-4-0-middlewares" class="headerlink" title="Default Express 4.0 middlewares"></a></h2><ul>
<li><p><a href="https://github.com/expressjs/morgan" target="_blank">morgan</a>: logger</p>
</li>
<li><p><a href="https://github.com/expressjs/body-parser" target="_blank">body-parser</a>: parse the body so you can access parameters in requests in <code>req.body</code>. e.g. <code>req.body.name</code>.</p>
</li>
<li><p><a href="https://github.com/expressjs/cookie-parser" target="_blank">cookie-parser</a>: parse the cookies so you can access parameters in cookies <code>req.cookies</code>. e.g. <code>req.cookies.name</code>.</p>
</li>
<li><p><a href="https://github.com/expressjs/serve-favicon" target="_blank">serve-favicon</a>: exactly that, serve favicon from route <code>/favicon.ico</code>. Should be call on the top before any other routing/middleware takes place to avoids unnecessary parsing.</p>
</li>
</ul>
<h2 id="Other-ExpressJS-Middlewares">Other ExpressJS Middlewares<a href="#Other-ExpressJS-Middlewares" class="headerlink" title="Other ExpressJS Middlewares"></a></h2><p>The following middlewares are not added by default, but It’s nice to know they exist at least:</p>
<ul>
<li><p><a href="https://github.com/expressjs/compression" target="_blank">compression</a>: compress all request. e.g. <code>app.use(compression())</code></p>
</li>
<li><p><a href="https://github.com/expressjs/session" target="_blank">session</a>: create sessions. e.g. <code>app.use(session({secret: &#39;Secr3t&#39;}))</code></p>
</li>
<li><p><a href="https://github.com/expressjs/method-override" target="_blank">method-override</a>: <code>app.use(methodOverride(&#39;_method&#39;))</code> Override methods to the one specified on the <code>_method</code> param. e.g. <code>GET /resource/1?_method=DELETE</code> will become <code>DELETE /resource/1</code>.</p>
</li>
<li><p><a href="https://github.com/expressjs/response-time" target="_blank">response-time</a>: <code>app.use(responseTime())</code> adds <code>X-Response-Time</code> header to responses.</p>
</li>
<li><p><a href="https://github.com/expressjs/errorhandler" target="_blank">errorhandler</a>: Aid development, by sending full error stack traces to the client when an error occurs. <code>app.use(errorhandler())</code>. It is good practice to surround it with an if statement to check <code>process.env.NODE_ENV === &#39;development&#39;</code>.</p>
</li>
<li><p><a href="https://github.com/expressjs/vhost" target="_blank">vhost</a>: Allows you to use different stack of middlewares depending on the request <code>hostname</code>. e.g. <code>app.use(vhost(&#39;*.user.local&#39;, userapp))</code> and <code>app.use(vhost(&#39;assets-*.example.com&#39;, staticapp))</code> where <code>userapp</code> and <code>staticapp</code> are different express instances with different middlewares.</p>
</li>
<li><p><a href="https://github.com/expressjs/csurf" target="_blank">csurf</a>: Adds a <strong>C</strong>ross-<strong>s</strong>ite <strong>r</strong>equest <strong>f</strong>orgery (CSRF) protection by adding a token to responds either via <code>session</code> or <code>cookie-parser</code> middleware. <code>app.use(csrf());</code></p>
</li>
<li><p><a href="https://github.com/expressjs/timeout" target="_blank">timeout</a>: halt execution if it takes more that a given time. e.g. <code>app.use(timeout(&#39;5s&#39;));</code>. However you need to check by yourself under every request with a middleware that checks <code>if (!req.timedout) next();</code>.</p>
</li>
</ul>
<h1 id="API-clients-Browser-Postman-and-curl">API clients (Browser, Postman and curl)<a href="#API-clients-Browser-Postman-and-curl" class="headerlink" title="API clients (Browser, Postman and curl)"></a></h1><p>I know you have not created any route yet. However, in the next sections you will. These are just three ways to retrieve, change and delete data from your future API.</p>
<h2 id="Curl">Curl<a href="#Curl" class="headerlink" title="Curl"></a></h2><figure class="highlight bash"><figcaption><span>Create tasks</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Create task</span></div><div class="line">curl -XPOST http://localhost:3000/todos <span class="_">-d</span> <span class="string">'name=Master%20Routes&amp;completed=false&amp;note=soon...'</span></div><div class="line"></div><div class="line"><span class="comment"># List tasks</span></div><div class="line">curl -XGET http://localhost:3000/todos</div></pre></td></tr></table></figure>
<h2 id="Browser-and-Postman">Browser and Postman<a href="#Browser-and-Postman" class="headerlink" title="Browser and Postman"></a></h2><p>If you open your browser and type <code>localhost:3000/todos</code> you will see all the tasks (when you implement it). However, you cannot do post commands by default. For further testing let’s use a Chrome plugin called <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en" target="_blank">Postman</a>. It allows you to use all the HTTP VERBS easily and check <code>x-www-form-urlencoded</code> for adding parameters.</p>
<img src="/images/postman_post.png" title="Postman POST example">
<h2 id="Websites-and-Mobile-Apps">Websites and Mobile Apps<a href="#Websites-and-Mobile-Apps" class="headerlink" title="Websites and Mobile Apps"></a></h2><p>Probably this is the main consumers of the APIs. You can interact with RESTful APIs using jQuery’s <code>$ajax</code> and its wrappers, BackboneJS’s Collections/models, AngularJS’s <code>$http</code> or <code>$resource</code>, among many other libraries/frameworks and mobile clients.</p>
<p>In the end, we are going to explain how to use AngularJS to interact with this API.</p>
<img src="/images/api_consumers.png" title="API Consumers">
<p><small class="muted">Image from CodeSchool</small></p>
<h1 id="Wiring-up-the-MEAN-Stack">Wiring up the MEAN Stack<a href="#Wiring-up-the-MEAN-Stack" class="headerlink" title="Wiring up the MEAN Stack"></a></h1><h2 id="Bootstrapping-ExpressJS">Bootstrapping ExpressJS<a href="#Bootstrapping-ExpressJS" class="headerlink" title="Bootstrapping ExpressJS"></a></h2><p>After a detour in Node CLI, MongoDB, Mongoose, tools and middlewares land we are back to our express todoApp. This time to create the routes and finalize our RESTful API.</p>
<p>Create the app typing <code>express -e todoApp</code>, install dependencies <code>cd todoApp &amp;&amp; npm install</code> and run the app <code>DEBUG=todoApp ./bin/www</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">express <span class="_">-e</span> todoApp</div><div class="line"></div><div class="line"><span class="comment"># =&gt;   create : todoApp                  # app directory  </span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/package.json     # file containing all the dependencies</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/app.js           # Entry point of the application: defines middleware, initialize database connections, routes and more.</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/public           # all files contained here are accessible through to public (browser or API calls).</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/public/javascripts</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/public/images</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/public/stylesheets</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/public/stylesheets/style.css</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/routes           # containes all the routes files</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/routes/index.js</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/routes/users.js</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/views            # contains all the HTML templates</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/views/index.ejs</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/views/error.ejs</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/bin              # contains executable files</span></div><div class="line"><span class="comment"># =&gt;   create : todoApp/bin/www          # bootstrap the app: loads app.js, and set the port for the webserver.</span></div><div class="line"><span class="comment"># =&gt;</span></div><div class="line"><span class="comment"># =&gt;   install dependencies:</span></div><div class="line"><span class="comment"># =&gt;     $ cd todoApp &amp;&amp; npm install</span></div><div class="line"><span class="comment"># =&gt;</span></div><div class="line"><span class="comment"># =&gt;   run the app:</span></div><div class="line"><span class="comment"># =&gt;     $ DEBUG=todoApp ./bin/www</span></div></pre></td></tr></table></figure>
<h2 id="Connect-ExpressJS-to-MongoDB">Connect ExpressJS to MongoDB<a href="#Connect-ExpressJS-to-MongoDB" class="headerlink" title="Connect ExpressJS to MongoDB"></a></h2><p>Hopefully, you have installed MongoDB in the <a href="#mongodb">setup section</a>, and you can start it typing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod</div></pre></td></tr></table></figure>
<p>Install the MongoDB driver for NodeJS called mongoose:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install mongoose --save</div></pre></td></tr></table></figure>
<p>Notice <code>--save</code>. It will add it to the <code>todoApp/package.json</code></p>
<p>Next, you need to require mongoose in the <code>todoApp/app.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line">mongoose.connect(<span class="string">'mongodb://localhost/todoApp'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(err) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'connection error'</span>, err);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'connection successful'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Now, When you run <code>npm start</code> or <code>./bin/www</code>, you will notice the message <code>connection successful</code>. Did you? Great!</p>
<p>You can find the repository <a href="https://github.com/amejiarosario/todoAPIjs" target="_blank" rel="external">here</a> and the diff code at this point:
<a href="https://github.com/amejiarosario/todoAPIjs/commit/d3be6a287e8aff39ab862971da4f050d04e552a1" target="_blank" rel="external">diff</a></p>
<h2 id="Creating-the-Todo-model-with-Mongoose">Creating the Todo model with Mongoose<a href="#Creating-the-Todo-model-with-Mongoose" class="headerlink" title="Creating the Todo model with Mongoose"></a></h2><p>It is show time! All the above was setup and preparation for this moment. Let bring the API to life.</p>
<p>Create a <code>models</code> directory and a <code>Todo.js</code> model:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir models</div><div class="line">touch models/Todo.js</div></pre></td></tr></table></figure>
<p>In the <code>models/Todo.js</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> TodoSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">  name: <span class="built_in">String</span>,</div><div class="line">  completed: <span class="built_in">Boolean</span>,</div><div class="line">  note: <span class="built_in">String</span>,</div><div class="line">  updated_at: &#123; type: <span class="built_in">Date</span>, <span class="keyword">default</span>: <span class="built_in">Date</span>.now &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Todo'</span>, TodoSchema);</div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/afc908027339b22f10de3b77518ac0728668d470" target="_blank" rel="external">diff</a></p>
<p>What’s going up there? Isn’t MongoDB suppose to be schemaless? Well, it is schemaless and very flexible indeed. However, very often we want bring sanity to our API/WebApp through validations and enforcing a schema to keep a consistent structure. Mongoose does that for us, which is nice.</p>
<p>You can use the following types:</p>
<ul>
<li>String</li>
<li>Boolean</li>
<li>Date</li>
<li>Array</li>
<li>Number</li>
<li>ObjectId</li>
<li>Mixed</li>
<li>Buffer</li>
</ul>
<h1 id="ExpressJS-Routes">ExpressJS Routes<a href="#ExpressJS-Routes" class="headerlink" title="ExpressJS Routes"></a></h1><p>To sum up we want to achieve the following:</p>
<table>
<thead>
<tr>
<th>Resource (URI)</th>
<th>POST (create)</th>
<th>GET (read)</th>
<th>PUT (update)</th>
<th>DELETE (destroy)</th>
</tr>
</thead>
<tbody>
<tr>
<td>/todos</td>
<td>create new task</td>
<td>list tasks</td>
<td>error</td>
<td>error</td>
</tr>
<tr>
<td>/todos/:id</td>
<td>error</td>
<td>show task :id</td>
<td>update task :id</td>
<td>destroy task ID 1</td>
</tr>
</tbody>
</table>
<p>Let’s setup the routes</p>
<figure class="highlight bash"><figcaption><span>Create a new route called `todos.js` in the `routes` folder or rename `users.js`</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv routes/users.js routes/todos.js</div></pre></td></tr></table></figure>
<p>In <code>app.js</code> add new <code>todos</code> route or just replace <code>./routes/users</code> for <code>./routes/todos</code></p>
<figure class="highlight javascript"><figcaption><span>Adding todos routes</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> todos = <span class="built_in">require</span>(<span class="string">'./routes/todos'</span>);</div><div class="line">app.use(<span class="string">'/todos'</span>, todos);</div></pre></td></tr></table></figure>
<p>All set! Now, let’s go back and edit our <code>routes/todos.js</code>.</p>
<h2 id="List-GET-todos">List: GET /todos<a href="#List-GET-todos" class="headerlink" title="List: GET /todos"></a></h2><p>Remember <a href="#mongoose-read-and-query"> mongoose query api</a>? Here’s how to use it in this context:</p>
<figure class="highlight javascript"><figcaption><span>routes/todos.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"></div><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"><span class="keyword">var</span> Todo = <span class="built_in">require</span>(<span class="string">'../models/Todo.js'</span>);</div><div class="line"></div><div class="line"><span class="comment">/* GET /todos listing. */</span></div><div class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.find(<span class="function"><span class="keyword">function</span> (<span class="params">err, todos</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</div><div class="line">    res.json(todos);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router;</div></pre></td></tr></table></figure>
<p>Harvest time! We don’t have any task in database but at least we verify it is working:</p>
<figure class="highlight bash"><figcaption><span>Testing all together</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Start database</span></div><div class="line">mongod</div><div class="line"></div><div class="line"><span class="comment"># Start Webserver (in other terminal tab)</span></div><div class="line">DEBUG=todoApp ./bin/www</div><div class="line"></div><div class="line"><span class="comment"># Test API (in other terminal tab)</span></div><div class="line">curl localhost:3000/todos</div><div class="line"><span class="comment"># =&gt; []%</span></div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/54ab912ea9aa2b6633ae12816beb6e6c3d2702e6" target="_blank" rel="external">diff</a></p>
<p>If it returns an empty array <code>[]</code> you are all set. If you get errors, try going back and making sure you didn’t forget anything or write a comment at the end of the post for help.</p>
<h2 id="Create-POST-todos">Create: POST /todos<a href="#Create-POST-todos" class="headerlink" title="Create: POST /todos"></a></h2><p>Back in <code>routes/todos.js</code>, we are going to add the ability to create using <a href="#mongoose-create">mongoose create</a>. Could you make it work before looking at the next example?</p>
<figure class="highlight javascript"><figcaption><span>routes/todos.js (showing just create route)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/* POST /todos */</span></div><div class="line">router.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.create(req.body, <span class="function"><span class="keyword">function</span> (<span class="params">err, post</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</div><div class="line">    res.json(post);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/28b60c4bf9c6d8b08c3351f725e17c7f40a077be" target="_blank" rel="external">diff</a></p>
<p>Few things:</p>
<ul>
<li>We are using the <code>router.post</code> instead of <code>router.get</code>.</li>
<li>You have to stop and run the server again: <code>DEBUG=todoApp ./bin/www</code>. From now on, use <code>nodemon</code> to refresh automatically. <code>npm install nodemon</code> and then run <code>nodemon</code>.</li>
</ul>
<h2 id="Show-GET-todos-id">Show: GET /todos/:id<a href="#Show-GET-todos-id" class="headerlink" title="Show: GET /todos/:id"></a></h2><p>This is a snap with <a href="#mongoose-read-and-query"><code>Todo.findById</code></a> and <code>req.params</code>. Notice that <code>params</code> matches the placeholder name we set while defining the route. <code>:id</code> in this case.</p>
<figure class="highlight javascript"><figcaption><span>routes/todos.js (showing just show route)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* GET /todos/id */</span></div><div class="line">router.get(<span class="string">'/:id'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.findById(req.params.id, <span class="function"><span class="keyword">function</span> (<span class="params">err, post</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</div><div class="line">    res.json(post);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/7d8bc67178a4f162858395845c076d9223926bf8" target="_blank" rel="external">diff</a></p>
<p>Test it in <em>POST</em>MAN using an <code>_id</code> from you created elements. E.g. <code>localhost:3000/todos/542d7d290a705126360ac635</code>.</p>
<h2 id="Update-PUT-todos-id">Update: PUT /todos/:id<a href="#Update-PUT-todos-id" class="headerlink" title="Update: PUT /todos/:id"></a></h2><p>Back in <code>routes/todos.js</code>, we are going to update tasks. This one you can do it before looking at the example bellow, review <a href="#mongoose-update">findByIdAndUpdate</a> and give it a try!</p>
<figure class="highlight javascript"><figcaption><span>routes/todos.js (showing just update route)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* PUT /todos/:id */</span></div><div class="line">router.put(<span class="string">'/:id'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.findByIdAndUpdate(req.params.id, req.body, <span class="function"><span class="keyword">function</span> (<span class="params">err, post</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</div><div class="line">    res.json(post);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/00dafe491e0d0b59fa53e86d8c187c42d7824200" target="_blank" rel="external">diff</a></p>
<p>Test it in <em>POST</em>MAN :)</p>
<h2 id="Destroy-DELETE-todos-id">Destroy: DELETE /todos/:id<a href="#Destroy-DELETE-todos-id" class="headerlink" title="Destroy: DELETE /todos/:id"></a></h2><p>Finally, the last one! Almost identical to <code>update</code>, use <a href="#mongoose-delete"><code>findByIdAndRemove</code></a>.</p>
<figure class="highlight javascript"><figcaption><span>routes/todos.js (showing just update route)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* DELETE /todos/:id */</span></div><div class="line">router.delete(<span class="string">'/:id'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  Todo.findByIdAndRemove(req.params.id, req.body, <span class="function"><span class="keyword">function</span> (<span class="params">err, post</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</div><div class="line">    res.json(post);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://github.com/amejiarosario/todoAPIjs/commit/cbf5366e2b4e1a683ed50d2148ed6a548616d3f8" target="_blank" rel="external">diff</a></p>
<p>Is it working? Cool, you are done then!
Is NOT working? take a look at the <a href="https://github.com/amejiarosario/todoAPIjs" target="_blank" rel="external">full repository</a>.</p>
<h1 id="What’s-next">What’s next?<a href="#What’s-next" class="headerlink" title="What’s next?"></a></h1><p>Connecting AngularJS with this endpoint. Checkout the third tutorial of this series.</p>

      </div>

      

        <section class="bio-box">
  <img class="m-a-1 not-scaled" src="/images/adrianmejia-small.png" alt="Adrian Mejia">
  <p class="p-x-1 muted">Adrian Mejia is a Software Engineer passionated about Web Development. He has worked professionally for more than 8 years and taught about them through books, posts and videos. Find our more <a href="/#about">here</a>.</p>
</section>


        <div class="m-y-4">
          <!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//adrianmejia.us2.list-manage.com/subscribe/post?u=2294bb28c5931a6f2338d2474&amp;id=52678e825b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Subscribe &amp; stay up to date!</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2294bb28c5931a6f2338d2474_52678e825b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" onclick="ga('send', 'event', 'newsletter', 'signup', 'page', location.pathname);"></div>
    </div>
</form>
</div>
<!--End mc_embed_signup-->

        </div>

        <footer>
          <div class="m-y-4">
            
              
              <div class="container">
              <h1 class="capitalize">Tutorial MEAN Stack Series</h1>
              <div class="row">
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/blog/2014/09/28/angularjs-tutorial-for-beginners-with-nodejs-expressjs-and-mongodb/">
    
      <img src="/images/AngularJSTutorial_300x250.png" width="300" height="250">
      <section class="p-a-1">
        <h3>AngularJS tutorial for beginners with NodeJS ExpressJS and MongoDB (Part I)</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
            
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/">
    
      <img src="/images/RESTfulAPIs_NodeJS__mongodb_320x250.png" width="300" height="250">
      <section class="p-a-1">
        <h3>Creating RESTful APIs with NodeJS and MongoDB Tutorial</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
            
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/blog/2014/10/03/mean-stack-tutorial-mongodb-expressjs-angularjs-nodejs/">
    
      <img src="/images/mean_300x250.png" width="300" height="250">
      <section class="p-a-1">
        <h3>MEAN Stack Tutorial MongoDB ExpressJS AngularJS NodeJS (Part III)</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
              </div><!-- .row -->
              </div><!-- .container -->
              
            
          </div>

          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     data-ad-client="ca-pub-9725767907287651"
     data-ad-slot="2343826126"
     style="display:block"
     
       data-ad-format="auto"
     
></ins>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </footer>
      <!-- if(page.layout !== 'snippet') -->
    </section>

    <!-- Asides (Ads, TOC, ...) -->
    <aside class="col-sm-4 p-x-2 col-xs-order-1">
      <section>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     data-ad-client="ca-pub-9725767907287651"
     data-ad-slot="6894900521"
     style="display:inline-block;width:300px;height:250px"
     
></ins>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

      </section>

      <section class="sticky-element--start">
        <div class="muted">
          <div class="p-y-1">
            <a href="#"><span id="back-to-top" title="Go back to the top of this page"><i class="fa fa-arrow-up"></i> Back to top</span></a>
            <a href="https://github.com/amejiarosario/amejiarosario.github.io/edit/source/source/_posts/2014-10-01-creating-a-restful-api-tutorial-with-nodejs-and-mongodb.markdown" class="p-x-3" title="Improve this post"><i class="fa fa-pencil"></i> Improve</a>
            <!-- <a href="#" title="Share this post"><i class="fa fa-share"></i> Share</a> -->
            <!--<div class="p-y-1">-->
              <!---->
              <!---->
              <!---->
              <!---->
            <!--</div>-->
          </div>

          
            <h3 class="toc-title">Contents</h3>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-a-RESTful-API"><span class="toc-number">1.</span> <span class="toc-text">What is a RESTful API?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Installing-the-MEAN-Stack-Backend"><span class="toc-number">2.</span> <span class="toc-text">Installing the MEAN Stack Backend</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Installing-MongoDB"><span class="toc-number">2.1.</span> <span class="toc-text">Installing MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installing-NodeJS"><span class="toc-number">2.2.</span> <span class="toc-text">Installing NodeJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installing-ExpressJS"><span class="toc-number">2.3.</span> <span class="toc-text">Installing ExpressJS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-MongoDB-with-Mongoose"><span class="toc-number">3.</span> <span class="toc-text">Using MongoDB with Mongoose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mongoose-CRUD"><span class="toc-number">3.1.</span> <span class="toc-text">Mongoose CRUD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mongoose-Create"><span class="toc-number">3.2.</span> <span class="toc-text">Mongoose Create</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mongoose-Read-and-Query"><span class="toc-number">3.3.</span> <span class="toc-text">Mongoose Read and Query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mongoose-Update"><span class="toc-number">3.4.</span> <span class="toc-text">Mongoose Update</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mongoose-Delete"><span class="toc-number">3.5.</span> <span class="toc-text">Mongoose Delete</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ExpressJS-and-Middlewares"><span class="toc-number">4.</span> <span class="toc-text">ExpressJS and Middlewares</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Default-Express-4-0-middlewares"><span class="toc-number">4.1.</span> <span class="toc-text">Default Express 4.0 middlewares</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other-ExpressJS-Middlewares"><span class="toc-number">4.2.</span> <span class="toc-text">Other ExpressJS Middlewares</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#API-clients-Browser-Postman-and-curl"><span class="toc-number">5.</span> <span class="toc-text">API clients (Browser, Postman and curl)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Curl"><span class="toc-number">5.1.</span> <span class="toc-text">Curl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Browser-and-Postman"><span class="toc-number">5.2.</span> <span class="toc-text">Browser and Postman</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Websites-and-Mobile-Apps"><span class="toc-number">5.3.</span> <span class="toc-text">Websites and Mobile Apps</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Wiring-up-the-MEAN-Stack"><span class="toc-number">6.</span> <span class="toc-text">Wiring up the MEAN Stack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bootstrapping-ExpressJS"><span class="toc-number">6.1.</span> <span class="toc-text">Bootstrapping ExpressJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Connect-ExpressJS-to-MongoDB"><span class="toc-number">6.2.</span> <span class="toc-text">Connect ExpressJS to MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-the-Todo-model-with-Mongoose"><span class="toc-number">6.3.</span> <span class="toc-text">Creating the Todo model with Mongoose</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ExpressJS-Routes"><span class="toc-number">7.</span> <span class="toc-text">ExpressJS Routes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#List-GET-todos"><span class="toc-number">7.1.</span> <span class="toc-text">List: GET /todos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-POST-todos"><span class="toc-number">7.2.</span> <span class="toc-text">Create: POST /todos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Show-GET-todos-id"><span class="toc-number">7.3.</span> <span class="toc-text">Show: GET /todos/:id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-PUT-todos-id"><span class="toc-number">7.4.</span> <span class="toc-text">Update: PUT /todos/:id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Destroy-DELETE-todos-id"><span class="toc-number">7.5.</span> <span class="toc-text">Destroy: DELETE /todos/:id</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What’s-next"><span class="toc-number">8.</span> <span class="toc-text">What’s next?</span></a></li></ol>
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     data-ad-client="ca-pub-9725767907287651"
     data-ad-slot="2343826126"
     style="display:inline-block;width:300px;height:600px;"
     
></ins>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

          
        </div>
      </section>
    </aside>
  </div>

  <!-- Next and previous posts -->
  
  <div class="article-nav m-y-4">
    
      <a href="/blog/2014/10/03/mean-stack-tutorial-mongodb-expressjs-angularjs-nodejs/" class="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"><i class="fa fa-chevron-left"></i> newer</strong>
        <div class="article-nav-title">
          
            MEAN Stack Tutorial MongoDB ExpressJS AngularJS NodeJS (Part III)
          
        </div>
      </a>
    
    
      <a href="/blog/2014/09/28/angularjs-tutorial-for-beginners-with-nodejs-expressjs-and-mongodb/" class="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older <i class="fa fa-chevron-right"></i></strong>
        <div class="article-nav-title">AngularJS tutorial for beginners with NodeJS ExpressJS and MongoDB (Part I)</div>
      </a>
    
  </div>
  

  <!-- comments -->
  <footer class="row sticky-element--end">
    <div class="col-xs-12">
      <section>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://adrianmejia.com';
      this.page.identifier = 'http://adrianmejia.com/blog/2014/10/01/creating-a-restful-api-tutorial-with-nodejs-and-mongodb/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = '//adrianmejia.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</section>

    </div>
  </footer>
</article>

    </main>

    <footer class="page-footer">
      <div class="container">
        <div class="p-y-2">
          &copy; 2016 <a href="http://adrianmejia.com">Adrian Mejia</a>
          <span class="muted m-x-4" title="Wed Aug 03 2016 21:38:30 GMT-0400 (EDT)">#obd386</span>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script id="dsq-count-scr" src="//adrianmejia.disqus.com/count.js" async></script>
    <script src="/js/main.js"></script>
    <!-- social scripts -->
    

    
      <script async defer type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-579cb31b46e2f7e6"></script>
      <script src="/js/posts.js"></script>    
  </body>
</html>
